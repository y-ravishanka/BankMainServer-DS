@page "/admindashboard"

@inject Database database

<PageTitle>Admin Dashboard</PageTitle>

<div class="container-fluid">
    <h1>Admin Dashboard</h1>
    <br />
    <div class="row justify-content-center" style="background-color: #212529;">
        <button class="button_custom item_center" @onclick="@(e=>setNave(0))" style="@ccss[0]">Login Activities</button>
        <button class="button_custom item_center" @onclick="@(e=>setNave(1))" style="@ccss[1]">Update Staff</button>
        <button class="button_custom item_center" @onclick="@(e=>setNave(2))" style="@ccss[2]">Reset Accounts</button>
    </div>

    

    @if (nav == 0)
    {
        <div class="container-fluid">
            <br /> 
            <div class="container-fluid item_center">
                <h2>Login Activity Details</h2>
            </div>
            <br />

            <div class="row mt-2">
                @if(navsearch == 1)
                {
                    <div class="container-fluid item_right">
                        <div class="container item_right">
                            <table>
                                <tr>
                                    <td>Search by Staff ID :</td>
                                </tr>
                                <tr>
                                    <td>
                                        <input type="text" class="w3-input search_input my-1 px-1">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <button class="search_button">Search</button>
                                        <button class="search_button">Clear</button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                }
                <div class=container-fluid>
                    <div class="search_nav_container">
                        <button class="search_nav_button" @onclick="@(e=>setNavSearch(0))" style="@cssSearch[0]">All</button><button class="search_nav_button" @onclick="@(e=>setNavSearch(1))" style="@cssSearch[1]">Search by ID</button>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="container-fluid my-2 w-100 overflow-auto" style="height: 400px;">
                    <table class="table">
                        <thead>
                            <tr class="table_style">
                                <th>Employee ID</th>
                                <th>Login Time</th>
                                <th>Logout Time</th>
                            </tr>
                        </thead>

                        <tbody>
                            @foreach (ActivityLog act in activities)
                            {
                                <tr>
                                    <td>@act.id</td>
                                    <td>@act.login</td>
                                    <td>@act.logout</td>
                                </tr>
                            }
                        </tbody>

                    </table>
                </div>
            </div>

        </div>
    }
    @if (nav == 1)
    {
        
        <div class="container-fluid">
            <br /> 
            <div class="container-fluid item_center">
                <h2>Update Staff Accounts</h2>
            </div>
            <br />

            <div class="row">
                <div class="container-fluid item_center my-2">

                    <div class="container item_center search_container py-3">
                        <table>
                            <tr>
                                <td><b>Search by NIC :</b></td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="text" class="w3-input search_input my-1 px-1" style="width: 320px;"> 
                                </td>
                            </tr>
                            <tr>
                                <td class="item_center">
                                    <button class="search_button mx-2">Search</button>
                                    <button class="search_button mx-2">Clear</button>
                                </td>
                            </tr>
                        </table>
                    </div>
                 
                </div>
            </div>

            <div class="row">
                <div class="card my-2">
                    <div class="card-body">

                        <div class="row">
                            <div class="container-fluid item_right">
                                <button class="none_button">
                                    <span class="oi oi-x"></span>
                                </button>
                            </div>
                        </div>

                        <div class="row">
                            <div class="container-fluid">

                                <h3>Yasas Ravishanka</h3>
                                <h5>9854623v</h5>

                                <div class="row">

                                    <div class="col-md-6">

                                        <div class="card mt-2">
                                            <div class="card-header">
                                                Basic Informations
                                            </div>
                                            <div class="card-body">
                                                <table>
                                                    <tr>
                                                        <td>ID </td>
                                                        <td>: @employee.id</td>
                                                    </tr>
                                                    <tr>
                                                        <td>NIC </td>
                                                        <td>: @employee.nic</td>
                                                    </tr>
                                                    <tr>
                                                        <td>First Name </td>
                                                        <td>: @employee.fname</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Last Name </td>
                                                        <td>: @employee.lname</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Date of Birth </td>
                                                        <td>: @employee.dob</td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>

                                        <div class="card mt-2">
                                            <div class="card-header">
                                                Location Informations
                                            </div>
                                            <div class="card-body">
                                                <table>
                                                    <tr>
                                                        <td>Address </td>
                                                        <td>: @employee.saddress</td>
                                                    </tr>
                                                    <tr>
                                                        <td>City </td>
                                                        <td>: @employee.city</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Distric </td>
                                                        <td>: @employee.distric</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Province </td>
                                                        <td>: @employee.province</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Zip Code </td>
                                                        <td>: @employee.zip</td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="col-md-6">

                                        <div class="card mt-2">
                                            <div class="card-header">
                                                Contact Informations
                                            </div>
                                            <div class="card-body">
                                                <table>
                                                    <tr>
                                                        <td>Phone number 1 </td>
                                                        <td>: @employee.phone1</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Phone Number 2 </td>
                                                        <td>: @employee.phone2</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Email </td>
                                                        <td>: @employee.email</td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>

                                        <div class="card mt-2">
                                            <div class="card-header">
                                                Status Informations
                                            </div>
                                            <div class="card-body">
                                                <table>
                                                    <tr>
                                                        <td>Employee Status </td>
                                                        <td>: </td>
                                                    </tr>
                                                    <tr>
                                                        <td>Posision </td>
                                                        <td>: </td>
                                                    </tr>
                                                    <tr>
                                                        <td>Branch ID </td>
                                                        <td>: @employee.branch</td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>

                                    </div>

                                </div>

                            </div>
                        </div>

                        <div class="row">
                            <div class="container-fluid my-2 px-5">
                                <div class="card">
                                    <div class="card-header">
                                        Change Branch
                                    </div>

                                    <div class="card-body">
                                        <div class="row">
                                            <div class="container-fluid py-1">
                                                change the branch employee working :  <b>Branch @selectBranch </b><br />
                                                <select class="mx-5 ms-5 px-5 py-1 mt-2" @onchange="changeBranchSelect">
                                                    @for(int i=0;i<11;++i)
                                                    {
                                                        @if(i==0)
                                                        {
                                                            <option value="@i" selected>Branch @i</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@i">Branch @i</option>
                                                        }
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="container-fluid item_right py-1 pe-4">
                                                <button class="search_button" style="@updatesavebut_css[0]">Save</button>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="container-fluid my-2 px-5">
                                <div class="card">
                                    <div class="card-header">
                                        Change Posision
                                    </div>

                                    <div class="card-body">
                                        <div class="row">
                                            <div class="container-fluid py-1">
                                                change the posision employee hold : <b>@selectPosi</b><br />
                                                <select class="mx-5 ms-5 px-5 py-1 mt-2" @onchange="changePosisionSelect">
                                                    @for(int i=0;i<mainPosi.Count;++i)
                                                    {
                                                        <option value="@mainPosi[i]">@mainPosi[i]</option>
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="container-fluid item_right py-1 pe-4">
                                                <button class="search_button" style="@updatesavebut_css[1]">Save</button>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

        </div>

    }


    @if(nav == 2)
    {
        <div class="container-fluid">
            <br /> 
            <div class="container-fluid item_center">
                <h2>Reset Staff Accounts</h2>
            </div>
            <br />

            <br /> 
            <div class="container-fluid">
                <h3>Reset Staff Accounts</h3>
            </div>
            <br />

            <div class="row">
                <div class="container-fluid item_center my-2">

                    <div class="container item_center search_container py-3">
                        <table>
                            <tr>
                                <td><b>Search by NIC :</b></td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="text" class="w3-input search_input my-1 px-1" style="width: 320px;"> 
                                </td>
                            </tr>
                            <tr>
                                <td class="item_center">
                                    <button class="search_button mx-2">Search</button>
                                    <button class="search_button mx-2">Clear</button>
                                </td>
                            </tr>
                        </table>
                    </div>
                 
                </div>
            </div>

            <div class="row my-2">
                <div class="container-fluid">
                    <table class="table">
                        <thead>
                            <tr class="table_style">
                                <th>NIC</th>
                                <th>Name</th>
                                <th>Position</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td></td>
                                <td></td>
                                <td>
                                </td>
                                <td>
                                    <button class="btn btn-dark">Reset</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <br /> 
            <div class="container-fluid">
                <h3>Reset bank Accounts</h3>
            </div>
            <br />

            <div class="row my-2">
                <div class="container-fluid">
                    <table class="table">
                        <thead>
                            <tr class="table_style">
                                <th>Branch No.</th>
                                <th>City</th>
                                <th>IP Address</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td></td>
                                <td></td>
                                <td>
                                    <input type="text" class="w3-input search_input my-1 px-1" style="width: 300px;"> 
                                </td>
                                <td>
                                    <button class="btn btn-dark">Save</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    }

    

</div>

@code {
    private string[]? ccss = new string[3];
    private string[]? updatesavebut_css = new string[2];
    private string[]? cssSearch = new string[2];
    private List<string>? mainPosi;
    //private string[]? branchposi = new string[3];
    private List<ActivityLog> activities = new();
    private int nav = 0;
    private int navsearch = 0;
    private Employee employee = new();
    private ClientLogin login = new();
    private string? nic = null;
    private string selectBranch = (0).ToString();
    private string selectPosi = "";
    private string update_posi = "";
    private int update_branch = 0;

    protected override void OnInitialized()
    {
        setNave(0);
        setNavSearch(0);
        clearUSaveCss();
        activities = database.GetActivityLogs(0, 0);
        update_branch = Convert.ToInt32(selectBranch);
        loadPosisionsSelections();
    }

    private void loadPosisionsSelections()
    {
        if(selectBranch == "0")
        {
            mainPosi = new List<string>() {"Admin", "HR", "Manager"};
        }
        else
        {
            mainPosi = new List<string>() {"Counter", "Admin", "Manager"};
        }
    }

    private void changeBranchSelect(ChangeEventArgs e)
    {
        selectBranch = e.Value.ToString();
        if(selectBranch != "0")
        {
            updatesavebut_css[0] = null;

        }
        update_branch = Convert.ToInt32(selectBranch);
        loadPosisionsSelections();
    }

    private void changePosisionSelect(ChangeEventArgs e)
    {
        selectPosi = e.Value.ToString();
        switch (selectPosi)
        {
            case "HR":
                update_posi = "hr";
                break;
            case "Manager":
                update_posi = "manager";
                break;
            case "Admin":
                update_posi = "admin";
                break;
        }
    }

    private void loadSearch(string n)
    {
        if(n != null)
        {

        }
    }

    private void clearUSaveCss()
    {
        for(int i=0; i<updatesavebut_css.Length; ++i)
        {
            setDesableButton(i);
        }
    }

    private void setDesableButton(int t)
    {
        updatesavebut_css[t] = "background-color: white;color: #212529;border: 1px solid #212529;";
    }

    private void clearSearchCss()
    {
        for(int i=0;i<cssSearch.Length;++i)
        {
            cssSearch[i] = null;
        }
    }

    private void setNavSearch(int t)
    {
        navsearch = t;
        setSearchCss(t);
    }

    private void setSearchCss(int t)
    {
        clearSearchCss();
        cssSearch[t] = "background-color: #212529; color: white;";
    }

    private void setNave(int t)
    {
        nav = t;
        setCss(t);
    }

    private void clearCss()
    {
        for(int i=0;i<ccss.Length;++i)
        {
            ccss[i] = null;
        }
    }

    private void setCss(int t)
    {
        clearCss();
        ccss[t] = "background-color: white; color: #212529;";
    }
}
